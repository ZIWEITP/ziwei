<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>唐朝宮廷紫微斗數</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript/lunar.js"></script>
    <style>
        /* 這裡完全保留你原本所有的 CSS 樣式，包含命盤與 UI 佈局 */
        :root { 
            --accent-color: #3A4652; --border-color: #e0e0e0; --bg-gray: #f0f2f5;
            --lu-green: #2E7D32; --quan-purple: #7B1FA2; --ke-blue: #1976D2; --ji-red: #D32F2F;
        }
        body { font-family: 'Noto Serif TC', serif; background: var(--bg-gray); margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        /* 輸入面板：完全對齊截圖 */
        .control-panel { background: white; padding: 45px; border-radius: 50px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); width: 850px; box-sizing: border-box; }
        .row { display: flex; gap: 30px; margin-bottom: 25px; align-items: flex-end; }
        .input-group { flex: 1; display: flex; flex-direction: column; }
        .input-group label { font-weight: 900; margin-bottom: 12px; color: #333; font-size: 20px; }
        input, select { padding: 16px 20px; border: 1.5px solid var(--border-color); border-radius: 18px; font-size: 19px; outline: none; background-color: #fff; }
        
        .options-row { display: flex; gap: 25px; margin-top: 15px; align-items: center; flex-wrap: wrap; }
        .checkbox-item { display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 700; font-size: 18px; }
        
        /* 雙胞胎提示詞樣式 */
        .multi-hint { color: #5E6D79; font-size: 16px; margin-top: 15px; font-weight: 700; line-height: 1.6; display: none; }
        #order-container { display: none; margin-left: 10px; }
        #birthOrder { padding: 8px 15px; border-radius: 12px; border: 1.5px solid var(--border-color); }

        .btn-start { width: 100%; padding: 22px; background: #3d4b59; color: white; border: none; border-radius: 22px; font-size: 26px; font-weight: 900; cursor: pointer; margin-top: 40px; letter-spacing: 8px; transition: background 0.3s; }
        .btn-start:hover { background: #2c3640; }

        /* 命盤樣式請保留在此處（省略以節省篇幅，請維持你原本的 grid 與 star-item CSS） */
        #result-page { display: none; padding: 20px 0; background: #fff; }
    </style>
</head>
<body>

<div id="input-page" class="control-panel">
    <div class="row">
        <div style="flex: 2.5;" class="input-group">
            <label>姓名</label>
            <input type="text" id="uName" placeholder="請輸入姓名">
        </div>
        <div style="flex: 1;" class="input-group">
            <label>性別</label>
            <select id="gender">
                <option value="" disabled selected>請選擇</option>
                <option value="男">男</option>
                <option value="女">女</option>
            </select>
        </div>
    </div>

    <div class="row">
        <div style="flex: 0.8;" class="input-group">
            <label>曆法</label>
            <select id="calType">
                <option value="solar">國曆</option>
                <option value="lunar">農曆</option>
            </select>
        </div>
        <div style="flex: 2;" class="input-group">
            <label>出生日期</label>
            <input type="text" id="bDate" placeholder="YYYYMMDD" maxlength="8">
        </div>
        <div style="flex: 2;" class="input-group">
            <label>出生時間</label>
            <div style="display: flex; align-items: center; gap: 12px;">
                <input type="text" id="bHour" placeholder="時" style="flex: 1;">
                <span style="font-weight: 900; font-size: 22px;">:</span>
                <input type="text" id="bMin" placeholder="分" value="00" style="flex: 1;">
            </div>
        </div>
    </div>

    <div class="options-row">
        <label class="checkbox-item"><input type="checkbox" id="isLeap"> 閏月</label>
        <label class="checkbox-item"><input type="checkbox" id="isDST"> 日光節約時間</label>
        <label class="checkbox-item">
            <input type="checkbox" id="hasMulti" onchange="toggleMultiLogic(this)"> 雙胞胎/多胞胎
        </label>
        <div id="order-container">
            <select id="birthOrder">
                <option value="1">第一胎</option>
                <option value="2">第二胎</option>
                <option value="3">第三胎</option>
                <option value="4">第四胎</option>
                <option value="5">第五胎</option>
            </select>
        </div>
    </div>
    
    <div id="multiHint" class="multi-hint">＊ 若非首胎，請輸入首胎出生時間，僅性別與胎次可依實際狀況調整。</div>

    <button class="btn-start" onclick="renderBoard()">開始排盤</button>
</div>

<script>
    // 常數定義完全保留你原本的 ZHI, GAN, PALACES, SI_HUA
    const ZHI = ["子", "丑", "寅", "卯", "辰", "巳", "午", "未", "申", "酉", "戌", "亥"];
    const GAN = ["甲", "乙", "丙", "丁", "戊", "己", "庚", "辛", "壬", "癸"];
    const PALACES = ["命", "兄", "夫", "子", "財", "疾", "遷", "友", "官", "田", "福", "父"];

    function toggleMultiLogic(cb) {
        const orderSelect = document.getElementById('order-container');
        const hint = document.getElementById('multiHint');
        if (cb.checked) {
            orderSelect.style.display = 'inline-block';
            hint.style.display = 'block';
        } else {
            orderSelect.style.display = 'none';
            hint.style.display = 'none';
        }
    }

    function renderBoard() {
        const gender = document.getElementById('gender').value;
        if(!gender) return alert("請選擇性別");
        
        const birthOrder = parseInt(document.getElementById('birthOrder').value) || 1;
        const uName = document.getElementById('uName').value || "命主";
        // ...其餘獲取日期、時間與 Lunar 轉換的原始代碼...

        // 【雙胞胎核心修改點：宮位推移】
        // 1. 先計算首胎命宮位置 (基於輸入的首胎時間)
        // let firstMIdx = (2 + (month - 1) - hIdx + 12) % 12; 

        // 2. 計算當前胎次命宮位置 (首胎位置逆撥，一胎撥一個宮位)
        // let currentMIdx = (firstMIdx - (birthOrder - 1) + 12) % 12;

        // 3. 在渲染 12 宮名稱時使用 currentMIdx
        // ZHI.forEach((z, i) => {
        //    const pName = PALACES[(currentMIdx - i + 12) % 12];
        //    // 更新 DOM...
        // });

        // 4. 安星邏輯（紫微、天府、五行局等）請務必「固定」使用 firstMIdx 進行計算
        // 這樣星曜位置就會保持不變，達成「星不動，宮位動」的排盤規則。

        document.getElementById('input-page').style.display = 'none';
        document.getElementById('result-page').style.display = 'block';
    }
</script>
</body>
</html>
